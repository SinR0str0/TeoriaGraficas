<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora de Gráficas</title>
  <style>
    .hidden { display: none; }
    .relacion-item {
      margin: 5px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .relacion-item span {
      flex-grow: 1;
    }
    button {
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>Calculadora de Gráficas</h1>
<form id="dataForm" novalidate>
  <div>
    <label for="lineas">Número de líneas (e): </label>
    <input type="number" id="lineas" min="1" step="1" required placeholder="Escriba el valor de e" />
    <div id="lineasError" class="error" aria-live="polite"></div>
  </div>

  <div>
    <label for="vertices">Número de vértices (v): </label>
    <input type="number" id="vertices" min="1" step="1" required placeholder="Escriba el número v" />
    <div id="verticesError" class="error" aria-live="polite"></div>
  </div>

  <div>
    <label for="relaciones">Relaciones de vértices</label>
    <input type="text" id="relaciones" required placeholder="Relaciones" />
    <div id="relacionesErrores" class="error" aria-live="polite"></div>
  </div>

  <div>
    <label for="tipoGrafo">Tipo de grafo:</label>
    <select id="tipoGrafo" name="tipoGrafo" required>
      <option value="">Seleccione una opción</option>
      <option value="ninguna">Ninguna</option>
      <option value="grafica">Gráfica</option>
      <option value="digrafica">Digráfica</option>
    </select>
  </div>

  <div id="relacionEditor">
    <span id="labelRelacion">
      Del vértice <input type="number" id="salida" placeholder="inicio" />
      al vértice <input type="number" id="llegada" placeholder="fin" />
    </span>
    <button type="button" id="guardarRelacion">✔</button>
  </div>

  <div id="relacionesLista"></div>

  <button type="submit">Calcular</button>
</form>

<script>
const tipoGrafo = document.getElementById("tipoGrafo");
const relacionEditor = document.getElementById("relacionEditor");
const labelRelacion = document.getElementById("labelRelacion");
const salidaInput = document.getElementById("salida");
const llegadaInput = document.getElementById("llegada");
const guardarBtn = document.getElementById("guardarRelacion");
const listaRelaciones = document.getElementById("relacionesLista");

let relaciones = [];
let editandoIndex = -1;
let tipoActual = ""; // para detectar cambio

// == CAMBIO DE GRAFO ==
tipoGrafo.addEventListener("change", () => {
  const nuevoTipo = tipoGrafo.value;
  if (nuevoTipo == "grafica" || nuevoTipo == "digrafica") {
    if (tipoActual && tipoActual !== nuevoTipo && relaciones.length > 0) {
      alert("Las relaciones serán ajustadas, el primer vértice será el de salida y el segundo el de llegada.");
    }
    tipoActual = nuevoTipo;
    actualizarLabel();
    mostrarEditor();
    renderRelaciones(); // actualizar los textos existentes
  } else {
    tipoActual = "ninguna";
    ocultarEditor();
  }
});

function actualizarLabel() {
  labelRelacion.innerHTML =
    tipoGrafo.value == "digrafica"
      ? `Sale del vértice <input type="number" id="salida" placeholder="inicio" /> llega al vértice <input type="number" id="llegada" placeholder="fin" />`
      : `Del vértice <input type="number" id="salida" placeholder="inicio" /> al vértice <input type="number" id="llegada" placeholder="fin" />`;

  // Reasignar inputs después de reemplazar el innerHTML
  document.getElementById("salida").value = salidaInput.value;
  document.getElementById("llegada").value = llegadaInput.value;
  salidaInput = document.getElementById("salida");
  llegadaInput = document.getElementById("llegada");
}

function mostrarEditor() {
  relacionEditor.classList.remove("hidden");
}

function ocultarEditor() {
  relacionEditor.classList.add("hidden");
}

function renderRelaciones() {
  listaRelaciones.innerHTML = "";
  relaciones.forEach((rel, index) => {
    const div = document.createElement("div");
    div.className = "relacion-item";

    const span = document.createElement("span");
    const texto = tipoGrafo.value == "digrafica"
      ? `Sale del vértice ${rel[0]} llega al vértice ${rel[1]}`
      : `Del vértice ${rel[0]} al vértice ${rel[1]}`;
    span.textContent = texto;

    const btnEditar = document.createElement("button");
    btnEditar.textContent = "✎";
    btnEditar.title = "Editar";
    btnEditar.onclick = () => editarRelacion(index);

    const btnBorrar = document.createElement("button");
    btnBorrar.textContent = "✖";
    btnBorrar.title = "Borrar";
    btnBorrar.onclick = () => borrarRelacion(index);

    div.appendChild(span);
    div.appendChild(btnEditar);
    div.appendChild(btnBorrar);

    listaRelaciones.appendChild(div);
  });
}

function guardarRelacion() {
  const s = parseInt(document.getElementById("salida").value);
  const l = parseInt(document.getElementById("llegada").value);
  if (isNaN(s) || isNaN(l)) return;

  if (editandoIndex >= 0) {
    relaciones[editandoIndex] = [s, l];
    editandoIndex = -1;
  } else {
    relaciones.push([s, l]);
  }

  document.getElementById("salida").value = "";
  document.getElementById("llegada").value = "";
  renderRelaciones();
}

function editarRelacion(index) {
  const [s, l] = relaciones[index];
  actualizarLabel(); // refresca campos
  document.getElementById("salida").value = s;
  document.getElementById("llegada").value = l;
  editandoIndex = index;
}

function borrarRelacion(index) {
  relaciones.splice(index, 1);
  renderRelaciones();
}

guardarBtn.addEventListener("click", guardarRelacion);
</script>

</body>
</html>
